<!DOCTYPE html>
<html lang=en>
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Caltrain Schedule</title>

<style>
html {
    /* scrollbar hack #1 */
    margin-left: calc(100vw - 100%);
    margin-right: 0;

    background-color: #F5F5F5;
}

h1, h2, h3, h4, h5, h6 {
  /* font-weight: lighter; */
  font-weight: normal;
}

body {
  max-width: 45rem; /* 0.9 of 50 */

  color: #303030;
  font: medium sans-serif;
  line-height: 1.8;
  /* font-weight: lighter; */
  font-weight: normal;

  margin: 2rem auto;
  padding: 0 0 10rem 0;
}

body img {
  display: block;
  max-width: 40rem; /* 0.8 of 50 */
  margin: 0 auto;
  padding: 0.5rem 0;
}

code {
    font-family: monospace;
    color: #202020;
    background-color: #E0E0E0;
    padding: 0.2rem 0.5rem;
}

pre code {
    display: block;
    line-height: 1.5;
    padding: 1.0rem;
    overflow-x: scroll;
    white-space: pre;
}

.imgcaption {
  max-width: 35rem; /* 0.7 of 50 */
  margin: -0.5rem auto 0.5rem auto; /* relay img's 0.5rem padding bottom*/
  /* font-size: x-small; */
  font-size: small;
  text-align: center;
  line-height: 1.5;
}

.note {
    font-family: monospace;
    color: #202020;
    background-color: #F0E080;
    padding: 1rem;
}

/* scrollbar hack #2 */
@media screen and (max-width: 50rem) {
    body {
        max-width: 90vw
    }
    body img {
        max-width: 80vw;
        margin: 0 auto;
    }
    .imgcaption {
      max-width: 70vw;
    }
}

@media print{
    html {
        margin: 0;
    }
    body {
        max-width: 90%;
        margin: 2rem auto;
    }
    body img {
        max-width: 60%;
        margin: 0 auto;
    }
    .imgcaption {
      max-width: 50%;
    }
    pre code {
        overflow-x: hidden;
        white-space: pre-wrap;
    }
}
select {
    font-size: 1.5em
}

</style>

</head>
<body>

<h2>Caltrain Schedule</h2>

<table style="text-align: center; margin: 0 auto">
    <tbody>
        <tr>
            <td>From</td>
            <td><select id="from"></select></td>
        </tr>
        <tr>
            <td>To</td>
            <td><select id="to"></select></td>
        </tr>
        <tr>
            <td>On</td>
            <td><select id="on">
                <option value=0>Weekdays</option>
                <option value=1>Weekends</option>
            </select></td>
        </tr>
    </tbody>
</table>

<br>

<table style="text-align: center; margin: 0 auto">
    <thead>
        <tr>
            <th style="width: 6em">Departure</th>
            <th style="width: 6em">Arrival</th>
        </tr>
    </thead>
    <tbody id="table">
        <!-- to be filled with js -->
    </tbody>
</table>

</body>
<script>

    function addopt(selectelem, name, val) {
        let opt = document.createElement("option");
        opt.appendChild(document.createTextNode(name));
        opt.value = val;
        selectelem.appendChild(opt);
    }

    function addrow(tableelem, val0, val1) {
        cell0 = document.createElement("td");
        cell1 = document.createElement("td");

        cell0.appendChild(document.createTextNode(val0));
        cell1.appendChild(document.createTextNode(val1));

        row = document.createElement("tr");
        row.appendChild(cell0);
        row.appendChild(cell1);

        tableelem.appendChild(row);
    }

    function viewstr(val) {
        let h = (val/100).toString(10).padStart(2, '0');
        let m = (val%100).toString(10).padStart(2, '0');
        return h + " : " + m;
    }

    let stations = [
        "mountainview",
        "sunnyvale"
    ];

    let weekdays_north = {
        "sunnyvale": [
            1400,
            1600
        ],
        "mountainview": [
            1500,
            1700
        ]
    };

    let weekdays_south = {
        "sunnyvale": [
            1400,
            1600
        ],
        "mountainview": [
            1500,
            1700
        ]
    };

    let weekends_north = {
        "sunnyvale": [
            900,
            1000
        ],
        "mountainview": [
            1100,
            1400
        ]
    }

    let weekends_south = {
        "sunnyvale": [
            900,
            1000
        ],
        "mountainview": [
            1100,
            1400
        ]
    }

    const fromselect = document.getElementById("from");
    const toselect = document.getElementById("to");
    const onselect = document.getElementById("on");
    const table = document.getElementById("table");

    function updatetable(fromlist, tolist) {
        if (fromlist.length != tolist.length) {
            console.log("lists' lengths does not match");
        }
        console.log("removing children");
        while (table.hasChildNodes()) {  
            table.removeChild(table.firstChild);
        }
        console.log("adding new rows");
        for (let i = 0; i < fromlist.length; i += 1) {
            if (fromlist[i] < 0 || tolist[i] < 0) {
                continue;
            }
            addrow(table, viewstr(fromlist[i]), viewstr(tolist[i]));
        }
    }

    function onchange() {
        console.log("onchange");
        if (onselect.value === "0") {
            updatetable(weekdays_north[fromselect.value], weekdays_north[toselect.value]);
        }
        else if (onselect.value === "1") {
            updatetable(weekends_north[fromselect.value], weekends_north[toselect.value]);
        }
        else {
            console.log("unkown option for *on*");
        }
        console.log(fromselect.value);
        console.log(toselect.value);
        console.log(onselect.value);
    }

    from.onchange = onchange;
    toselect.onchange = onchange;
    onselect.onchange = onchange;

    addopt(fromselect, "Sunnyvale", "sunnyvale");
    addopt(fromselect, "MountainView", "mountainview");
    addopt(toselect, "Sunnyvale", "sunnyvale");
    addopt(toselect, "MountainView", "mountainview");

</script>
</html>
